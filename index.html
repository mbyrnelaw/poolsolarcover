<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Heating Simulation with Solar Cover</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #controls { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Interactive Pool Heating Simulation</h1>
    <p>Use the slider to adjust the jet angle (-90° = downward into the mass for mixing, 0° = horizontal across the surface, 90° = upward towards the cover for maximum convection under the solar cover). Click Start to run the simulation, Reset to stop and reset.</p>
    <p>The heating rate is higher when jets are directed upward at the cover, increasing convective transfer from the cover to the water. The pool water color changes sensitively with temperature (blue cool, red warm).</p>
    <canvas id="poolCanvas" width="600" height="400" style="border:1px solid black;"></canvas>
    <div id="controls">
        <label for="angle">Jet Angle (degrees, -90 down, 0 horizontal, 90 up): </label>
        <input type="range" id="angle" min="-90" max="90" value="0" step="1">
        <span id="angleValue">0°</span>
        <br>
        <button id="startBtn">Start Simulation</button>
        <button id="resetBtn">Reset</button>
        <p id="status"></p>
    </div>
    <script>
        var canvas = document.getElementById('poolCanvas');
        var ctx = canvas.getContext('2d');
        var angleSlider = document.getElementById('angle');
        var angleValue = document.getElementById('angleValue');
        var startBtn = document.getElementById('startBtn');
        var resetBtn = document.getElementById('resetBtn');
        var status = document.getElementById('status');

        var T = 20; // initial temperature in C
        var time = 0; // in minutes
        var interval = null;

        function updateAngleValue() {
            angleValue.innerHTML = angleSlider.value + '°';
        }

        angleSlider.oninput = function() {
            updateAngleValue();
            drawPool();
        };

        function drawPool() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate color based on temperature (blue at 20C, red at 40C, but more sensitive)
            var hue = 240 - (T - 20) * 24; // Increased sensitivity: full change over ~10C
            if (hue < 0) hue = 0;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.fillRect(50, 100, 500, 250); // pool water

            // Solar cover on top
            ctx.fillStyle = 'rgba(0, 255, 0, 0.5)'; // semi-transparent green
            ctx.fillRect(50, 100, 500, 10);

            // Jet
            var jetX = 60;
            var jetY = 200;
            var jetLen = 100;
            var thetaDeg = parseFloat(angleSlider.value);
            var theta = thetaDeg * Math.PI / 180;
            var effective_theta = -theta;
            var dx = jetLen * Math.cos(effective_theta);
            var dy = jetLen * Math.sin(effective_theta);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(jetX, jetY);
            ctx.lineTo(jetX + dx, jetY + dy);
            ctx.stroke();

            // Text
            ctx.font = '16px Arial';
            ctx.fillStyle = 'black';
            ctx.fillText('Pool Temperature: ' + T.toFixed(1) + ' °C', 400, 60);
            ctx.fillText('Simulation Time: ' + time + ' minutes', 400, 80);
        }

        function simulateStep() {
            var thetaDeg = parseFloat(angleSlider.value);
            var theta = thetaDeg * Math.PI / 180;
            // Effective heating efficiency: higher when angle is positive (upward)
            var efficiency = (1 + Math.sin(theta)) / 2; // 1 at 90°, 0.5 at 0°, 0 at -90°
            var dT = 0.05 * efficiency;
            T += dT;
            time += 1;
            drawPool();
            status.innerText = 'Current Heating Rate: ' + (dT * 60).toFixed(2) + ' °C/hour';
        }

        startBtn.onclick = function() {
            if (!interval) {
                interval = setInterval(simulateStep, 200); // Update every 200ms for smooth animation
            }
        };

        resetBtn.onclick = function() {
            clearInterval(interval);
            interval = null;
            T = 20;
            time = 0;
            drawPool();
            status.innerText = '';
        };

        // Initial draw
        updateAngleValue();
        drawPool();
    </script>
</body>
</html>
