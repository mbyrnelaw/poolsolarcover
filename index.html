<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Heating Simulation with Solar Cover</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #controls { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Interactive Pool Heating Simulation</h1>
    <p>Use the slider to adjust the jet angle (0&deg; = across the surface for enhanced convection under the solar cover, 90&deg; = downward into the mass for mixing). Click Start to run the simulation, Reset to stop and reset.</p>
    <p>The heating rate is higher when jets are directed across the surface, increasing convective transfer from the cover to the water. The pool water color changes with temperature (blue cool, red warm).</p>
    <canvas id="poolCanvas" width="600" height="400" style="border:1px solid black;"></canvas>
    <div id="controls">
        <label for="angle">Jet Angle (degrees, 0 horizontal, 90 down): </label>
        <input type="range" id="angle" min="0" max="90" value="45" step="1">
        <span id="angleValue">45&deg;</span>
        <br>
        <button id="startBtn">Start Simulation</button>
        <button id="resetBtn">Reset</button>
        <p id="status"></p>
    </div>
    <script>
        var canvas = document.getElementById('poolCanvas');
        var ctx = canvas.getContext('2d');
        var angleSlider = document.getElementById('angle');
        var angleValue = document.getElementById('angleValue');
        var startBtn = document.getElementById('startBtn');
        var resetBtn = document.getElementById('resetBtn');
        var status = document.getElementById('status');

        var T = 20; // initial temperature in C var time = 0; // in minutes
        var interval = null;

        function updateAngleValue() {
            angleValue.innerHTML = angleSlider.value + '&deg;';
        }

        angleSlider.oninput = function() {
            updateAngleValue();
            drawPool();
        };

        function drawPool() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate color based on temperature (blue at 20C, red at 40C)
            var hue = 240 - (T - 20) * 6; // 240 blue to 0 red
            if (hue < 0) hue = 0;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.fillRect(50, 100, 500, 250); // pool water

            // Solar cover on top
            ctx.fillStyle = 'rgba(0, 255, 0, 0.5)'; // semi-transparent green
            ctx.fillRect(50, 100, 500, 10);

            // Jet
            var jetX = 60;
            var jetY = 200;
            var jetLen = 100;
            var theta = parseFloat(angleSlider.value) * Math.PI / 180;
            var dx = jetLen * Math.cos(theta);
            var dy = jetLen * Math.sin(theta);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(jetX, jetY);
            ctx.lineTo(jetX + dx, jetY + dy);
            ctx.stroke();

            // Text
            ctx.font = '16px Arial';
            ctx.fillStyle = 'black';
            ctx.fillText('Pool Temperature: ' + T.toFixed(1) + ' °C', 400, 60);
            ctx.fillText('Simulation Time: ' + time + ' minutes', 400, 80);
        }

        function simulateStep() {
            var thetaDeg = parseFloat(angleSlider.value);
            // Effective heating efficiency: higher when angle is low (surface flow)
            var efficiency = Math.cos(thetaDeg * Math.PI / 180); // 1 at 0°, 0 at 90°
            // Base heating rate: assume max 0.05 °C per minute (3 °C/hour, accelerated for sim)
            var dT = 0.05 * efficiency;
            T += dT;
            time += 1;
            drawPool();
            status.innerText = 'Current Heating Rate: ' + (dT * 60).toFixed(2) + ' °C/hour';
        }

        startBtn.onclick = function() {
            if (!interval) {
                interval = setInterval(simulateStep, 200); // Update every 200ms for smooth animation
            }
        };

        resetBtn.onclick = function() {
            clearInterval(interval);
            interval = null;
            T = 20;
            time = 0;
            drawPool();
            status.innerText = '';
        };

        // Initial draw
        updateAngleValue();
        drawPool();
    </script>
</body>
</html>
